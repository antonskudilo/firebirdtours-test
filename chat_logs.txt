–Ω—É–∂–Ω–æ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —à–∞–≥–∏ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è

–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ (–Ω–∞ —Ä—É—Å—Å–∫–æ–º).

Back-end Developer

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∞–ª—é—Ç.
–ú–æ–¥—É–ª—å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤–∞–ª—é—Ç (–Ω–∞ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ - –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω –≤ –º–æ–¥—É–ª–µ –∏–ª–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É). –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å https://freecurrencyapi.com/ (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ API –ø–æ —Å—Å—ã–ª–∫–µ https://freecurrencyapi.com/docs) –¥–ª—è –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∞–ª—é—Ç –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏. –ú–æ–¥—É–ª—å –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ü–µ–Ω—ã –∏–∑ –æ–¥–Ω–æ–π –≤–∞–ª—é—Ç—ã –≤ –¥—Ä—É–≥—É—é (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–æ–µ $converter->convert(123, ‚ÄòUSD‚Äô, ‚ÄòRUB‚Äô);). –¢–∞–∫–∂–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ –∞–¥–º–∏–Ω–∫–µ, –≥–¥–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã–≤–µ–¥–µ–Ω—ã –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç.
–î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å https://freecurrencyapi.com/ –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–º–µ–Ω–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ —Å–∞–π—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, https://github.com/everapihq/freecurrencyapi-php). –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å –ø–æ–º–æ—â—å—é Guzzle, curl, file_get_content –∏–ª–∏ –¥—Ä—É–≥–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è http –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
–î–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞ –≤–∞–ª—é—Ç –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–π —É–¥–æ–±–Ω—ã–π PHP-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫.

–ó–∞–¥–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —Å –ø–æ–º–æ—â—å—é AI. –í–º–µ—Å—Ç–µ —Å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º –∑–∞–¥–∞–Ω–∏–µ–º –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –∏–ª–∏ –≤—ã–≥—Ä—É–∑–∫—É —á–∞—Ç–æ–≤ –∏–∑ AI-–∞–≥–µ–Ω—Ç–∞ –∏–ª–∏ AI-—á–∞—Ç–æ–≤.

–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è:

1. –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ laravel 12, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –º–æ–¥–µ–ª–∏ —Ä–µ–∫–≤–µ—Å—Ç-—Ç–æ–Ω–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä-—Å–µ—Ä–≤–∏—Å-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

2. –∞–¥–º–∏–Ω–∫–∞ –Ω–∞ blade, 
- –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã —Ä–µ—Å—É—Ä–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ CurrenciesController, –≤ delete –∏—Å–ø–æ–ª—å–∑—É–µ–º softDelete
- –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ index –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ CurrencyRatesController
- –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π loginController —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞
- –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å blade views. –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ layout –∏ pages: currencies.index, currencies.create, currencies.edit, currency_rates.index, –¥–ª—è —Å—Ç–∏–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ–º bootstrap
- –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω–∫—É - —Ñ–æ—Ä–º–∞ —Å –ø–æ–ª—è–º–∏ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å
- —Ä–æ—É—Ç—ã –∞–¥–º–∏–Ω–∫–∏ —á–µ—Ä–µ–∑ middleware auth

3. –ú–æ–¥–µ–ª–∏ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é User. –ü–æ–ª—è:
id,
login,
password,
timestamps

–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –º–æ–¥–µ–ª–∏ Currency. –ü–æ–ª—è:
id,
code - varchar, 8
name_plural - var_char, 32
timestamps,
deleted_at

–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –º–æ–¥–µ–ª–∏ CurrencyRate. –ü–æ–ª—è:
id,
currency_id,
timestamps,

4. –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç –ø—Ä–æ–≤–æ–¥–∏–º —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏ —á–µ—Ä–µ–∑ –∫—Ä–æ–Ω –∑–∞–¥–∞—á—É. –Ω—É–∂–Ω–æ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–∞ –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –≤ –∫—Ä–æ–Ω –∑–∞–¥–∞—á–µ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –Ω–µ—É–¥–∞—á–Ω–æ - –∑–∞–¥–∞—á–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 10 –º–∏–Ω—É—Ç + —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ª–æ–≥ –æ –Ω–µ—É–¥–∞—á–Ω–æ–π –ø–æ–ø—ã—Ç–∫–µ

5. –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫ api –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å —Ä–µ–∫–≤–µ—Å—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ Guzzle —Å –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–≥—Ä—É–∑—á–∏–∫–∞. –û—Ç –Ω–µ–≥–æ —Å–æ–∑–¥–∞—Ç—å –¥–æ—á–µ—Ä–Ω–∏–π –∫–ª–∞—Å—Å –≤ –∫–æ—Ç–æ—Ä–æ–º —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É –∑–∞–ø—Ä–æ—Å–∞ —Å —É—á–µ—Ç–æ–º env(currencies-api-key)

–≤—ã–∑—ã–≤–∞–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –µ–Ω–¥–ø–æ–∏–Ω—Ç —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ –±–∞–∑–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞. –≤ –º–µ—Ç–æ–¥–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç

–ø—Ä–∏–º–µ—Ä —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ api
$url = "https://api.freecurrencyapi.com/v1/latest";

$curl = curl_init($url);
$headers = array(
"apikey: YOUR-APIKEY",
);

$resp = curl_exec($curl);
var_dump($resp);

6. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π api –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–∏—Å—É. –¥–ª—è –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–∞—Ä—à—Ä—É—Ç–µ –∏ –Ω–µ–π–º—Å–ø–µ–π—Å–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º v1
–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏ api —Ä–æ—É—Ç. –ü–µ—Ä–µ–≤–æ–¥ –∏–∑ –æ–¥–Ω–æ–π –≤–∞–ª—é—Ç—ã –≤ –¥—Ä—É–≥—É—é –≤—ã–ø–æ–ª–Ω–Ω—è–µ–º —Å –ø–æ–º–æ—â—å—é –ø–æ–ª—è latest_exchange_rate –º–æ–¥–µ–ª–∏ CurrencyRate, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç—ã –∫ –¥–æ–ª–ª–∞—Ä—É –°–®–ê

7. –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã
- —é–Ω–∏—Ç —Ç–µ—Å—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∞–ª—é—Ç
- feature-test –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—É–±–ª–∏—á–Ω–æ–º—É api
- feature-test –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω–∫–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∞—Ä—à—Ä—É—Ç–∞–º –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–æ–ª–µ–π

8. –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏–¥—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–∞ –≤–∞–ª—é—Ç, –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ –∞–¥—Ä–µ—Å—É: https://freecurrencyapi.com/docs/currency-list –∏ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ä–æ–ª—å—é –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (login - admin, password - admin (–∑–∞—Ö–µ—â–∏—Ä–æ–≤–∞–Ω—ã–π))

9. –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–ø–∞–∫–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≤ –¥–æ–∫–µ—Ä –∫–æ–º–ø–æ–∑, –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º php 8.4 apache + sqlite + —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
–ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏, —Å–∏–¥—ã, –∑–∞–ø—É—â–µ–Ω—ã –¥–≤–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ - –æ–¥–∏–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≤—Ç–æ—Ä–æ–π –¥–ª—è —Ä–∞–±–æ—Ç—ã –æ—á–µ—Ä–µ–¥–∏

--------------------------------------------------------------------------------

–û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°—Ç–µ–∫

Laravel 12

PHP 8.4

Blade + Bootstrap

SQLite

Guzzle

–û—á–µ—Ä–µ–¥–∏ + cron

Docker Compose

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–æ–¥—Ö–æ–¥

Request ‚Üí Controller (thin) ‚Üí Service ‚Üí Repository ‚Üí Model

üß≠ ROADMAP –í–´–ü–û–õ–ù–ï–ù–ò–Ø
–≠–¢–ê–ü 0. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

–†–µ–∑—É–ª—å—Ç–∞—Ç: —á–∏—Å—Ç—ã–π Laravel 12 –ø—Ä–æ–µ–∫—Ç –≤ Docker

–®–∞–≥–∏

–°–æ–∑–¥–∞—Ç—å Laravel 12 –ø—Ä–æ–µ–∫—Ç

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env

–ü–æ–¥–∫–ª—é—á–∏—Ç—å SQLite

–ü–æ–¥–∫–ª—é—á–∏—Ç—å Guzzle

–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å Docker Compose (–ø–æ–∑–∂–µ –¥–æ—Ä–∞–±–æ—Ç–∞–µ–º)

–≠–¢–ê–ü 1. –ú–æ–¥–µ–ª–∏ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
1.1 User

–ú–∏–≥—Ä–∞—Ü–∏—è

users
- id
- login (string, unique)
- password (string)
- timestamps


–ú–æ–¥–µ–ª—å

$fillable

—Å–∫—Ä—ã—Ç—å password

1.2 Currency

–ú–∏–≥—Ä–∞—Ü–∏—è

currencies
- id
- code (varchar 8, unique)
- name_plural (varchar 32)
- timestamps
- deleted_at


–ú–æ–¥–µ–ª—å

SoftDeletes

—Å–≤—è–∑—å —Å CurrencyRate

1.3 CurrencyRate

–ú–∏–≥—Ä–∞—Ü–∏—è

currency_rates
- id
- currency_id (FK)
- latest_exchange_rate (decimal)
- timestamps


–ú–æ–¥–µ–ª—å

belongsTo Currency

–≠–¢–ê–ü 2. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–∞–¥–º–∏–Ω–∫–∞)

–¶–µ–ª—å: –ø—Ä–æ—Å—Ç–∞—è –∞–¥–º–∏–Ω–∫–∞ –±–µ–∑ Laravel Breeze

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

LoginController

showLoginForm

login

logout

Guard: web

Middleware: auth

üìå –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞

login

password

–≠–¢–ê–ü 3. –ê–¥–º–∏–Ω–∫–∞ (Blade + Bootstrap)
Layout
resources/views/layouts/admin.blade.php

3.1 CurrenciesController (resource)

–ú–µ—Ç–æ–¥—ã

index

create

store

edit

update

destroy ‚Üí softDelete

Views

currencies.index
currencies.create
currencies.edit

3.2 CurrencyRatesController

–ú–µ—Ç–æ–¥—ã

index

View

currency_rates.index

3.3 –†–æ—É—Ç—ã –∞–¥–º–∏–Ω–∫–∏
Route::middleware('auth')->group(function () {
    Route::resource('currencies', CurrenciesController::class);
    Route::get('currency-rates', [CurrencyRatesController::class, 'index']);
});

–≠–¢–ê–ü 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å FreeCurrencyAPI
4.1 –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π API-–∫–ª–∏–µ–Ω—Ç
abstract class BaseApiRequest
{
    protected Client $client;

    abstract protected function endpoint(): string;
    abstract protected function params(): array;

    public function send(): array;
}

4.2 –†–µ–∞–ª–∏–∑–∞—Ü–∏—è FreeCurrencyApiRequest

endpoint: /v1/latest

headers:

apikey: env('CURRENCIES_API_KEY')

–≠–¢–ê–ü 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤ (cron + queue)
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

Job: UpdateCurrencyRatesJob

Command: currency:update-rates

–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (Kernel)

–õ–æ–≥–∏–∫–∞:

–ó–∞–ø—Ä–æ—Å –∫ API

–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞:

–ª–æ–≥

retry —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç

–≠–¢–ê–ü 6. –°–µ—Ä–≤–∏—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∞–ª—é—Ç
–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
interface CurrencyConverterInterface
{
    public function convert(float $amount, string $from, string $to): float;
}

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è

—á–µ—Ä–µ–∑ latest_exchange_rate

–±–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ ‚Äî USD

üìå –§–æ—Ä–º—É–ª–∞:

amount_in_usd = amount / from_rate
result = amount_in_usd * to_rate

–≠–¢–ê–ü 7. –ü—É–±–ª–∏—á–Ω—ã–π API (v1)
Endpoint
POST /api/v1/convert

Controller

CurrencyConvertController

Request validation

Response
{
  "amount": 100,
  "from": "USD",
  "to": "EUR",
  "result": 92.34
}

–≠–¢–ê–ü 8. –°–∏–¥—ã
CurrencySeeder

–∑–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –≤–∞–ª—é—Ç

–∏—Å—Ç–æ—á–Ω–∏–∫: docs freecurrencyapi

UserSeeder
login: admin
password: admin (bcrypt)
role: admin

–≠–¢–ê–ü 9. –¢–µ—Å—Ç—ã
Unit

CurrencyConverterTest

Feature

Public API convert

Admin auth

Admin routes access

–≠–¢–ê–ü 10. Docker Compose
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

app

php 8.4 + apache

artisan migrate --seed

queue

php 8.4

php artisan queue:work

--------------------------------------------------------------------------------

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —à–∞–≥—É 1
–°—Ñ–æ—Ä–º–∏—Ä—É–π –∫–æ–¥ –¥–ª—è –ø—É–Ω–∫—Ç–æ–≤ 1.1, 1.2, 1.3

--------------------------------------------------------------------------------


–û—Ç–ª–∏—á–Ω–æ, –∏–¥—ë–º –ø–æ –ø–ª–∞–Ω—É üëç
–ù–∏–∂–µ –ø–æ–ª–Ω—ã–π –≥–æ—Ç–æ–≤—ã–π –∫–æ–¥ –¥–ª—è –≠–¢–ê–ü–ê 1: –ø—É–Ω–∫—Ç—ã 1.1, 1.2, 1.3 –ø–æ–¥ Laravel 12, —Å —É—á—ë—Ç–æ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∑–∞–¥–∞–Ω–∏—è.

üîπ 1.1 User ‚Äî –º–∏–≥—Ä–∞—Ü–∏—è –∏ –º–æ–¥–µ–ª—å
üìÑ –ú–∏–≥—Ä–∞—Ü–∏—è users

database/migrations/xxxx_xx_xx_create_users_table.php

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::create('users', function (Blueprint $table) {
            $table->id();
            $table->string('login')->unique();
            $table->string('password');
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('users');
    }
};

üìÑ –ú–æ–¥–µ–ª—å User

app/Models/User.php

<?php

namespace App\Models;

use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;

class User extends Authenticatable
{
    use Notifiable;

    protected $fillable = [
        'login',
        'password',
    ];

    protected $hidden = [
        'password',
    ];
}


üìå –í–∞–∂–Ω–æ:
–ú—ã –Ω–∞—Å–ª–µ–¥—É–µ–º—Å—è –æ—Ç Authenticatable, —á—Ç–æ–±—ã auth middleware —Ä–∞–±–æ—Ç–∞–ª –±–µ–∑ –∫–æ—Å—Ç—ã–ª–µ–π.

üîπ 1.2 Currency ‚Äî –º–∏–≥—Ä–∞—Ü–∏—è –∏ –º–æ–¥–µ–ª—å
üìÑ –ú–∏–≥—Ä–∞—Ü–∏—è currencies

database/migrations/xxxx_xx_xx_create_currencies_table.php

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::create('currencies', function (Blueprint $table) {
            $table->id();
            $table->string('code', 8)->unique();
            $table->string('name_plural', 32);
            $table->timestamps();
            $table->softDeletes();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('currencies');
    }
};

üìÑ –ú–æ–¥–µ–ª—å Currency

app/Models/Currency.php

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;
use Illuminate\Database\Eloquent\Relations\HasMany;

class Currency extends Model
{
    use SoftDeletes;

    protected $fillable = [
        'code',
        'name_plural',
    ];

    public function rates(): HasMany
    {
        return $this->hasMany(CurrencyRate::class);
    }
}

üîπ 1.3 CurrencyRate ‚Äî –º–∏–≥—Ä–∞—Ü–∏—è –∏ –º–æ–¥–µ–ª—å
üìÑ –ú–∏–≥—Ä–∞—Ü–∏—è currency_rates

database/migrations/xxxx_xx_xx_create_currency_rates_table.php

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::create('currency_rates', function (Blueprint $table) {
            $table->id();
            $table->foreignId('currency_id')
                ->constrained('currencies')
                ->cascadeOnDelete();

            $table->decimal('latest_exchange_rate', 15, 8);
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('currency_rates');
    }
};

üìÑ –ú–æ–¥–µ–ª—å CurrencyRate

app/Models/CurrencyRate.php

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

class CurrencyRate extends Model
{
    protected $fillable = [
        'currency_id',
        'latest_exchange_rate',
    ];

    public function currency(): BelongsTo
    {
        return $this->belongsTo(Currency::class);
    }
}

‚úÖ –ß—Ç–æ –≤ –∏—Ç–æ–≥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –Ω–∞ —à–∞–≥–µ 1

‚úî User (–º–∏–≥—Ä–∞—Ü–∏—è + –º–æ–¥–µ–ª—å, –≥–æ—Ç–æ–≤ –∫ auth)
‚úî Currency (SoftDelete, —Å–≤—è–∑–∏)
‚úî CurrencyRate (FK, decimal –ø–æ–¥ –∫—É—Ä—Å—ã)
‚úî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¢–ó

--------------------------------------------------------------------------------

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —à–∞–≥—É 2

--------------------------------------------------------------------------------

–≠–¢–ê–ü 2. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
üìå –ß—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ–º

LoginController

–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞ (Blade + Bootstrap)

–õ–æ–≥–∏–Ω / –ª–æ–≥–∞—É—Ç

Middleware auth

–ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–µ login, –∞ –Ω–µ email

2.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ auth –ø–æ–¥ –ø–æ–ª–µ login
üìÑ config/auth.php

–£–±–µ–¥–∏—Å—å, —á—Ç–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä users —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π:

'providers' => [
    'users' => [
        'driver' => 'eloquent',
        'model' => App\Models\User::class,
    ],
],


–ù–∏—á–µ–≥–æ –±–æ–ª—å—à–µ –º–µ–Ω—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.

2.2 LoginController
üìÑ app/Http/Controllers/Auth/LoginController.php
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;

class LoginController extends Controller
{
    public function showLoginForm()
    {
        return view('auth.login');
    }

    public function login(Request $request)
    {
        $credentials = $request->validate([
            'login' => ['required', 'string'],
            'password' => ['required', 'string'],
        ]);

        if (Auth::attempt($credentials)) {
            $request->session()->regenerate();

            return redirect()->intended('/currencies');
        }

        return back()->withErrors([
            'login' => '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å',
        ]);
    }

    public function logout(Request $request)
    {
        Auth::logout();

        $request->session()->invalidate();
        $request->session()->regenerateToken();

        return redirect()->route('login.form');
    }
}


üìå –ü–æ—á–µ–º—É —Ç–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

Auth::attempt() ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç Laravel

session()->regenerate() ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç session fixation

intended() ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ—Å–ª–µ middleware auth

2.3 –†–æ—É—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
üìÑ routes/web.php
use App\Http\Controllers\Auth\LoginController;

Route::get('/login', [LoginController::class, 'showLoginForm'])
    ->name('login.form');

Route::post('/login', [LoginController::class, 'login'])
    ->name('login');

Route::post('/logout', [LoginController::class, 'logout'])
    ->name('logout');

2.4 Middleware auth –¥–ª—è –∞–¥–º–∏–Ω–∫–∏

–ü–æ–∑–∂–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ —Ä–æ—É—Ç—ã –±—É–¥—É—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

Route::middleware('auth')->group(function () {
    // admin routes
});


Laravel middleware auth —É–∂–µ –µ—Å—Ç—å ‚Äî –Ω–∏—á–µ–≥–æ –¥–æ–ø–∏—Å—ã–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.

2.5 Blade ‚Äî layout –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
üìÑ resources/views/layouts/admin.blade.php
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>@yield('title', 'Admin')</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<nav class="navbar navbar-dark bg-dark mb-4">
    <div class="container">
        <a class="navbar-brand" href="{{ url('/currencies') }}">Currency Admin</a>

        @auth
            <form method="POST" action="{{ route('logout') }}">
                @csrf
                <button class="btn btn-outline-light btn-sm">–í—ã—Ö–æ–¥</button>
            </form>
        @endauth
    </div>
</nav>

<div class="container">
    @yield('content')
</div>

</body>
</html>

2.6 Blade ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞
üìÑ resources/views/auth/login.blade.php
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-4">

            <div class="card">
                <div class="card-header text-center">
                    –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É
                </div>

                <div class="card-body">
                    <form method="POST" action="{{ route('login') }}">
                        @csrf

                        <div class="mb-3">
                            <label class="form-label">–õ–æ–≥–∏–Ω</label>
                            <input type="text"
                                   name="login"
                                   class="form-control @error('login') is-invalid @enderror"
                                   value="{{ old('login') }}"
                                   required>
                            @error('login')
                                <div class="invalid-feedback">{{ $message }}</div>
                            @enderror
                        </div>

                        <div class="mb-3">
                            <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                            <input type="password"
                                   name="password"
                                   class="form-control"
                                   required>
                        </div>

                        <button class="btn btn-primary w-100">
                            –í–æ–π—Ç–∏
                        </button>
                    </form>
                </div>
            </div>

        </div>
    </div>
</div>

</body>
</html>

‚úÖ –ß—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –Ω–∞ —à–∞–≥–µ 2

‚úî LoginController (login / logout)
‚úî –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–æ–ª–µ login
‚úî Middleware auth –≥–æ—Ç–æ–≤
‚úî –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚úî Layout –∞–¥–º–∏–Ω–∫–∏
‚úî Bootstrap –ø–æ–¥–∫–ª—é—á—ë–Ω

üëâ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

–≠–¢–ê–ü 3 ‚Äî –ê–¥–º–∏–Ω–∫–∞

CurrenciesController (resource, soft delete)

CurrencyRatesController@index

Blade —Å—Ç—Ä–∞–Ω–∏—Ü—ã:

currencies.index

currencies.create

currencies.edit

currency_rates.index

–†–æ—É—Ç—ã –∞–¥–º–∏–Ω–∫–∏

–°–∫–∞–∂–∏: ¬´–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —à–∞–≥—É 3¬ª ‚Äî –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º.

–ø—Ä–∞–≤–∫–∏ –ø–æ —à–∞–±–ª–æ–Ω–∞–º —Å—Ç—Ä–∞–Ω–∏—Ü:

–∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–π layout, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø–æ–¥–∫–ª—é—á–∞–µ–º bootstrap. title –ø–µ—Ä–µ–¥–∞–µ–º –∏–∑ —Å—Ç—Ä–∞–Ω–∏—Ü. –¥–æ–±–∞–≤–∏—Ç—å lang="{{ app()->getLocale() }}"
–¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º bootstrap (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
–≤ —Ä–æ—É—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –º–∏–¥–≤–∞—Ä—ã guest –¥–ª—è –º–µ—Ç–æ–¥–æ–≤ login –∏ auth –¥–ª—è logout

–û—Ç–ª–∏—á–Ω—ã–µ –ø—Ä–∞–≤–∫–∏ ‚Äî –æ–Ω–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏ –æ–∂–∏–¥–∞–µ–º—ã–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-–∫–æ–¥–∞ üëç
–î–∞–≤–∞–π –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –≤–Ω–µ—Å—ë–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ —è –ø–æ–∫–∞–∂—É –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —ç—Ç–∞–ª–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –∫–æ–º–º–∏—Ç–∏—Ç—å.

‚úÖ –ü—Ä–∞–≤–∫–∏ –ø–æ —à–∞–±–ª–æ–Ω–∞–º (Blade)
1Ô∏è‚É£ –û–±—â–∏–π layout —Å Bootstrap –∏ lang

–¢–µ–ø–µ—Ä—å:

–æ–¥–∏–Ω layout –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü (–≤–∫–ª—é—á–∞—è login)

Bootstrap –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ layout

title –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∏–∑ —Å—Ç—Ä–∞–Ω–∏—Ü

–¥–æ–±–∞–≤–ª–µ–Ω lang="{{ app()->getLocale() }}"

üìÑ resources/views/layouts/app.blade.php
<!DOCTYPE html>
<html lang="{{ app()->getLocale() }}">
<head>
    <meta charset="UTF-8">
    <title>@yield('title', 'Admin')</title>

    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet"
    >
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-dark mb-4">
    <div class="container">
        <a class="navbar-brand" href="{{ url('/currencies') }}">
            Currency Admin
        </a>

        @auth
            <form method="POST" action="{{ route('logout') }}">
                @csrf
                <button class="btn btn-outline-light btn-sm">
                    –í—ã—Ö–æ–¥
                </button>
            </form>
        @endauth
    </div>
</nav>

<div class="container">
    @yield('content')
</div>

</body>
</html>


üìå
–≠—Ç–æ—Ç layout —Ç–µ–ø–µ—Ä—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π ‚Äî –∏ –¥–ª—è login, –∏ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏.

2Ô∏è‚É£ –®–∞–±–ª–æ–Ω –ª–æ–≥–∏–Ω–∞ —á–µ—Ä–µ–∑ –æ–±—â–∏–π layout
üìÑ resources/views/auth/login.blade.php
@extends('layouts.app')

@section('title', '–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É')

@section('content')
<div class="row justify-content-center">
    <div class="col-md-4">

        <div class="card">
            <div class="card-header text-center">
                –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É
            </div>

            <div class="card-body">
                <form method="POST" action="{{ route('login') }}">
                    @csrf

                    <div class="mb-3">
                        <label class="form-label">–õ–æ–≥–∏–Ω</label>
                        <input type="text"
                               name="login"
                               class="form-control @error('login') is-invalid @enderror"
                               value="{{ old('login') }}"
                               required>

                        @error('login')
                            <div class="invalid-feedback">{{ $message }}</div>
                        @enderror
                    </div>

                    <div class="mb-3">
                        <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password"
                               name="password"
                               class="form-control"
                               required>
                    </div>

                    <button class="btn btn-primary w-100">
                        –í–æ–π—Ç–∏
                    </button>
                </form>
            </div>
        </div>

    </div>
</div>
@endsection


‚úî Bootstrap ‚Äî –∏–∑ layout
‚úî Title ‚Äî —á–µ—Ä–µ–∑ @section('title')
‚úî –ù–∏–∫–∞–∫–æ–≥–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è HTML

‚úÖ –ü—Ä–∞–≤–∫–∏ –ø–æ —Ä–æ—É—Ç–∞–º (guest / auth middleware)
–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:

login ‚Üí guest

logout ‚Üí auth

–≠—Ç–æ best practice üëç

üìÑ routes/web.php
use App\Http\Controllers\Auth\LoginController;

/*
|--------------------------------------------------------------------------
| Auth routes
|--------------------------------------------------------------------------
*/

Route::middleware('guest')->group(function () {
    Route::get('/login', [LoginController::class, 'showLoginForm'])
        ->name('login.form');

    Route::post('/login', [LoginController::class, 'login'])
        ->name('login');
});

Route::post('/logout', [LoginController::class, 'logout'])
    ->middleware('auth')
    ->name('logout');


üìå –ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç:

–∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–ø–∞–¥—ë—Ç –Ω–∞ /login

logout –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ redirect()->intended()

‚úÖ –ò—Ç–æ–≥ –ø–æ—Å–ª–µ –ø—Ä–∞–≤–æ–∫

‚úî –û–¥–∏–Ω –æ–±—â–∏–π layout
‚úî Bootstrap –ø–æ–¥–∫–ª—é—á—ë–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ
‚úî lang="{{ app()->getLocale() }}"
‚úî title —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∏–∑ —Å—Ç—Ä–∞–Ω–∏—Ü
‚úî guest / auth middleware —Ä–∞—Å—Å—Ç–∞–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

--------------------------------------------------------------------------------

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —à–∞–≥—É 3

--------------------------------------------------------------------------------

–≠–¢–ê–ü 3. –ê–¥–º–∏–Ω–∫–∞ (Currencies + CurrencyRates)
üìå –ß—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ–º

CurrenciesController (resource, soft delete)

CurrencyRatesController@index

Blade views:

currencies.index

currencies.create

currencies.edit

currency_rates.index

–†–æ—É—Ç—ã –∞–¥–º–∏–Ω–∫–∏ –ø–æ–¥ auth

3.1 Repository —Å–ª–æ–π
üìÑ app/Repositories/CurrencyRepository.php
<?php

namespace App\Repositories;

use App\Models\Currency;
use Illuminate\Database\Eloquent\Collection;

class CurrencyRepository
{
    public function all(): Collection
    {
        return Currency::query()->latest()->get();
    }

    public function find(int $id): Currency
    {
        return Currency::query()->findOrFail($id);
    }

    public function create(array $data): Currency
    {
        return Currency::query()->create($data);
    }

    public function update(Currency $currency, array $data): Currency
    {
        $currency->update($data);
        return $currency;
    }

    public function delete(Currency $currency): void
    {
        $currency->delete(); // soft delete
    }
}

üìÑ app/Repositories/CurrencyRateRepository.php
<?php

namespace App\Repositories;

use App\Models\CurrencyRate;
use Illuminate\Database\Eloquent\Collection;

class CurrencyRateRepository
{
    public function allWithCurrency(): Collection
    {
        return CurrencyRate::query()
            ->with('currency')
            ->latest()
            ->get();
    }
}

3.2 Service —Å–ª–æ–π
üìÑ app/Services/CurrencyService.php
<?php

namespace App\Services;

use App\Models\Currency;
use App\Repositories\CurrencyRepository;
use Illuminate\Database\Eloquent\Collection;

class CurrencyService
{
    public function __construct(
        private readonly CurrencyRepository $repository
    ) {}

    public function list(): Collection
    {
        return $this->repository->all();
    }

    public function create(array $data): Currency
    {
        return $this->repository->create($data);
    }

    public function update(int $id, array $data): Currency
    {
        $currency = $this->repository->find($id);
        return $this->repository->update($currency, $data);
    }

    public function delete(int $id): void
    {
        $currency = $this->repository->find($id);
        $this->repository->delete($currency);
    }

    public function find(int $id): Currency
    {
        return $this->repository->find($id);
    }
}

üìÑ app/Services/CurrencyRateService.php
<?php

namespace App\Services;

use App\Repositories\CurrencyRateRepository;
use Illuminate\Database\Eloquent\Collection;

class CurrencyRateService
{
    public function __construct(
        private readonly CurrencyRateRepository $repository
    ) {}

    public function list(): Collection
    {
        return $this->repository->allWithCurrency();
    }
}

3.3 Form Request (–≤–∞–ª–∏–¥–∞—Ü–∏—è)
üìÑ app/Http/Requests/CurrencyRequest.php
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class CurrencyRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }

    public function rules(): array
    {
        return [
            'code' => ['required', 'string', 'max:8'],
            'name_plural' => ['required', 'string', 'max:32'],
        ];
    }
}

3.4 –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã (—Ç–æ–Ω–∫–∏–µ)
üìÑ app/Http/Controllers/CurrenciesController.php
<?php

namespace App\Http\Controllers;

use App\Http\Requests\CurrencyRequest;
use App\Services\CurrencyService;

class CurrenciesController extends Controller
{
    public function __construct(
        private readonly CurrencyService $service
    ) {}

    public function index()
    {
        return view('currencies.index', [
            'currencies' => $this->service->list(),
        ]);
    }

    public function create()
    {
        return view('currencies.create');
    }

    public function store(CurrencyRequest $request)
    {
        $this->service->create($request->validated());

        return redirect()
            ->route('currencies.index')
            ->with('success', '–í–∞–ª—é—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞');
    }

    public function edit(int $id)
    {
        return view('currencies.edit', [
            'currency' => $this->service->find($id),
        ]);
    }

    public function update(CurrencyRequest $request, int $id)
    {
        $this->service->update($id, $request->validated());

        return redirect()
            ->route('currencies.index')
            ->with('success', '–í–∞–ª—é—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
    }

    public function destroy(int $id)
    {
        $this->service->delete($id);

        return redirect()
            ->route('currencies.index')
            ->with('success', '–í–∞–ª—é—Ç–∞ —É–¥–∞–ª–µ–Ω–∞');
    }
}

üìÑ app/Http/Controllers/CurrencyRatesController.php
<?php

namespace App\Http\Controllers;

use App\Services\CurrencyRateService;

class CurrencyRatesController extends Controller
{
    public function __construct(
        private readonly CurrencyRateService $service
    ) {}

    public function index()
    {
        return view('currency_rates.index', [
            'rates' => $this->service->list(),
        ]);
    }
}

3.5 Blade views
üìÑ resources/views/currencies/index.blade.php
@extends('layouts.app')

@section('title', '–í–∞–ª—é—Ç—ã')

@section('content')
<a href="{{ route('currencies.create') }}" class="btn btn-success mb-3">
    –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª—é—Ç—É
</a>

<table class="table table-bordered">
    <tr>
        <th>ID</th>
        <th>Code</th>
        <th>Name</th>
        <th></th>
    </tr>
    @foreach($currencies as $currency)
        <tr>
            <td>{{ $currency->id }}</td>
            <td>{{ $currency->code }}</td>
            <td>{{ $currency->name_plural }}</td>
            <td>
                <a href="{{ route('currencies.edit', $currency) }}" class="btn btn-sm btn-primary">Edit</a>

                <form method="POST"
                      action="{{ route('currencies.destroy', $currency) }}"
                      class="d-inline">
                    @csrf
                    @method('DELETE')
                    <button class="btn btn-sm btn-danger">Delete</button>
                </form>
            </td>
        </tr>
    @endforeach
</table>
@endsection

üìÑ resources/views/currencies/create.blade.php
@extends('layouts.app')

@section('title', '–°–æ–∑–¥–∞–Ω–∏–µ –≤–∞–ª—é—Ç—ã')

@section('content')
<form method="POST" action="{{ route('currencies.store') }}">
    @csrf

    <div class="mb-3">
        <label class="form-label">Code</label>
        <input name="code" class="form-control" required>
    </div>

    <div class="mb-3">
        <label class="form-label">Name plural</label>
        <input name="name_plural" class="form-control" required>
    </div>

    <button class="btn btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</form>
@endsection

üìÑ resources/views/currencies/edit.blade.php
@extends('layouts.app')

@section('title', '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª—é—Ç—ã')

@section('content')
<form method="POST" action="{{ route('currencies.update', $currency) }}">
    @csrf
    @method('PUT')

    <div class="mb-3">
        <label class="form-label">Code</label>
        <input name="code" class="form-control" value="{{ $currency->code }}" required>
    </div>

    <div class="mb-3">
        <label class="form-label">Name plural</label>
        <input name="name_plural" class="form-control" value="{{ $currency->name_plural }}" required>
    </div>

    <button class="btn btn-primary">–û–±–Ω–æ–≤–∏—Ç—å</button>
</form>
@endsection

üìÑ resources/views/currency_rates/index.blade.php
@extends('layouts.app')

@section('title', '–ö—É—Ä—Å—ã –≤–∞–ª—é—Ç')

@section('content')
<table class="table table-striped">
    <tr>
        <th>Currency</th>
        <th>Rate (USD)</th>
        <th>Updated</th>
    </tr>

    @foreach($rates as $rate)
        <tr>
            <td>{{ $rate->currency->code }}</td>
            <td>{{ $rate->latest_exchange_rate }}</td>
            <td>{{ $rate->updated_at }}</td>
        </tr>
    @endforeach
</table>
@endsection

3.6 –†–æ—É—Ç—ã –∞–¥–º–∏–Ω–∫–∏
üìÑ routes/web.php
use App\Http\Controllers\CurrenciesController;
use App\Http\Controllers\CurrencyRatesController;

Route::middleware('auth')->group(function () {
    Route::resource('currencies', CurrenciesController::class);
    Route::get('currency-rates', [CurrencyRatesController::class, 'index'])
        ->name('currency-rates.index');
});

‚úÖ –ò—Ç–æ–≥ –≠–¢–ê–ü–ê 3

‚úî Resource-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å soft delete
‚úî –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ controller / service / repository
‚úî Blade admin UI
‚úî Bootstrap
‚úî Middleware auth

--------------------------------------------------------------------------------

–ø—Ä–∞–≤–∫–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ 
- –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å Entity - –Ω–µ Active record. –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –º–∞—Å—Å–∏–≤, –≤ php-doc —É–∫–∞–∑–∞—Ç—å —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—Å–∏–≤ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞ Entity
- –∑–∞–≤–µ—Å—Ç–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ entities –¥–ª—è Currency –∏ CurrencyRate 
- –≤ CurrencyRequest –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ code. –†–∞–∑–¥–µ–ª–∏—Ç—å CurrencyRequest –Ω–∞ –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ä–µ–∫–≤–µ—Å—Ç–∞: –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è 
- –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å DTO –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Ç–æ–º –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ —Å–µ—Ä–≤–∏—Å –∞ –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. –ó–∞–≤–µ—Å—Ç–∏ DTO –¥–ª—è Currency –∏ CurrencyRate 
- –≤ Blade views —á–µ—Ä–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É–∫–∞–∑–∞—Ç—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–∞—Å—Å–∏–≤—ã —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏


--------------------------------------------------------------------------------

1. Entities (–Ω–µ ActiveRecord)

Entities ‚Äî –ø—Ä–æ—Å—Ç—ã–µ immutable-–æ–±—ä–µ–∫—Ç—ã, –Ω–µ –∑–Ω–∞—é—Ç –æ –ë–î.

üìÑ app/Entities/CurrencyEntity.php
<?php

namespace App\Entities;

class CurrencyEntity
{
    public function __construct(
        public readonly int $id,
        public readonly string $code,
        public readonly string $namePlural,
    ) {}
}

üìÑ app/Entities/CurrencyRateEntity.php
<?php

namespace App\Entities;

class CurrencyRateEntity
{
    public function __construct(
        public readonly int $id,
        public readonly int $currencyId,
        public readonly string $currencyCode,
        public readonly float $latestExchangeRate,
        public readonly string $updatedAt,
    ) {}
}

‚úÖ 2. DTO (Controller ‚Üí Service ‚Üí Repository)

DTO ‚Äî –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.

üìÑ app/DTO/CurrencyDTO.php
<?php

namespace App\DTO;

class CurrencyDTO
{
    public function __construct(
        public readonly string $code,
        public readonly string $namePlural,
    ) {}
}

üìÑ app/DTO/CurrencyRateDTO.php
<?php

namespace App\DTO;

class CurrencyRateDTO
{
    public function __construct(
        public readonly int $currencyId,
        public readonly float $latestExchangeRate,
    ) {}
}

‚úÖ 3. Repository ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º Entity (–º–∞—Å—Å–∏–≤)
‚ùó –í–∞–∂–Ω–æ

–ù–ï –≤–æ–∑–≤—Ä–∞—â–∞–µ–º Eloquent

–í–æ–∑–≤—Ä–∞—â–∞–µ–º array<CurrencyEntity>

–¢–∏–ø —É–∫–∞–∑—ã–≤–∞–µ–º –≤ phpDoc

üìÑ app/Repositories/CurrencyRepository.php
<?php

namespace App\Repositories;

use App\DTO\CurrencyDTO;
use App\Entities\CurrencyEntity;
use App\Models\Currency;

/**
 * @return CurrencyEntity[]
 */
class CurrencyRepository
{
    /**
     * @return CurrencyEntity[]
     */
    public function all(): array
    {
        return Currency::query()
            ->latest()
            ->get()
            ->map(fn (Currency $currency) => new CurrencyEntity(
                id: $currency->id,
                code: $currency->code,
                namePlural: $currency->name_plural,
            ))
            ->all();
    }

    public function create(CurrencyDTO $dto): void
    {
        Currency::query()->create([
            'code' => $dto->code,
            'name_plural' => $dto->namePlural,
        ]);
    }

    public function update(int $id, CurrencyDTO $dto): void
    {
        Currency::query()
            ->whereKey($id)
            ->update([
                'code' => $dto->code,
                'name_plural' => $dto->namePlural,
            ]);
    }

    public function delete(int $id): void
    {
        Currency::query()->whereKey($id)->delete();
    }
}

üìÑ app/Repositories/CurrencyRateRepository.php
<?php

namespace App\Repositories;

use App\Entities\CurrencyRateEntity;
use App\Models\CurrencyRate;

/**
 * @return CurrencyRateEntity[]
 */
class CurrencyRateRepository
{
    /**
     * @return CurrencyRateEntity[]
     */
    public function all(): array
    {
        return CurrencyRate::query()
            ->with('currency')
            ->latest()
            ->get()
            ->map(fn (CurrencyRate $rate) => new CurrencyRateEntity(
                id: $rate->id,
                currencyId: $rate->currency_id,
                currencyCode: $rate->currency->code,
                latestExchangeRate: (float) $rate->latest_exchange_rate,
                updatedAt: $rate->updated_at->toDateTimeString(),
            ))
            ->all();
    }
}

‚úÖ 4. Service ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç —Å DTO –∏ Entity
üìÑ app/Services/CurrencyService.php
<?php

namespace App\Services;

use App\DTO\CurrencyDTO;
use App\Entities\CurrencyEntity;
use App\Repositories\CurrencyRepository;

/**
 * @return CurrencyEntity[]
 */
class CurrencyService
{
    public function __construct(
        private readonly CurrencyRepository $repository
    ) {}

    /**
     * @return CurrencyEntity[]
     */
    public function list(): array
    {
        return $this->repository->all();
    }

    public function create(CurrencyDTO $dto): void
    {
        $this->repository->create($dto);
    }

    public function update(int $id, CurrencyDTO $dto): void
    {
        $this->repository->update($id, $dto);
    }

    public function delete(int $id): void
    {
        $this->repository->delete($id);
    }
}

‚úÖ 5. Form Requests ‚Äî —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ create / update + unique
üìÑ CurrencyStoreRequest.php
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class CurrencyStoreRequest extends FormRequest
{
    public function rules(): array
    {
        return [
            'code' => ['required', 'string', 'max:8', 'unique:currencies,code'],
            'name_plural' => ['required', 'string', 'max:32'],
        ];
    }

    public function authorize(): bool
    {
        return true;
    }
}

üìÑ CurrencyUpdateRequest.php
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class CurrencyUpdateRequest extends FormRequest
{
    public function rules(): array
    {
        return [
            'code' => [
                'required',
                'string',
                'max:8',
                'unique:currencies,code,' . $this->route('currency'),
            ],
            'name_plural' => ['required', 'string', 'max:32'],
        ];
    }

    public function authorize(): bool
    {
        return true;
    }
}

‚úÖ 6. Controller ‚Üí —Ñ–æ—Ä–º–∏—Ä—É–µ–º DTO
üìÑ CurrenciesController.php
<?php

namespace App\Http\Controllers;

use App\DTO\CurrencyDTO;
use App\Http\Requests\CurrencyStoreRequest;
use App\Http\Requests\CurrencyUpdateRequest;
use App\Services\CurrencyService;

class CurrenciesController extends Controller
{
    public function __construct(
        private readonly CurrencyService $service
    ) {}

    public function index()
    {
        return view('currencies.index', [
            /** @var \App\Entities\CurrencyEntity[] $currencies */
            'currencies' => $this->service->list(),
        ]);
    }

    public function store(CurrencyStoreRequest $request)
    {
        $dto = new CurrencyDTO(
            code: $request->string('code'),
            namePlural: $request->string('name_plural'),
        );

        $this->service->create($dto);

        return redirect()->route('currencies.index');
    }

    public function update(CurrencyUpdateRequest $request, int $currency)
    {
        $dto = new CurrencyDTO(
            code: $request->string('code'),
            namePlural: $request->string('name_plural'),
        );

        $this->service->update($currency, $dto);

        return redirect()->route('currencies.index');
    }

    public function destroy(int $currency)
    {
        $this->service->delete($currency);

        return redirect()->route('currencies.index');
    }
}

‚úÖ 7. Blade ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ —Ç–∏–ø–∞—Ö –¥–∞–Ω–Ω—ã—Ö
üìÑ currencies/index.blade.php
@extends('layouts.app')

@section('title', '–í–∞–ª—é—Ç—ã')

@section('content')
{{-- @var \App\Entities\CurrencyEntity[] $currencies --}}

<table class="table table-bordered">
    @foreach($currencies as $currency)
        <tr>
            <td>{{ $currency->id }}</td>
            <td>{{ $currency->code }}</td>
            <td>{{ $currency->namePlural }}</td>
        </tr>
    @endforeach
</table>
@endsection

üìÑ currency_rates/index.blade.php
@extends('layouts.app')

@section('title', '–ö—É—Ä—Å—ã –≤–∞–ª—é—Ç')

@section('content')
{{-- @var \App\Entities\CurrencyRateEntity[] $rates --}}

<table class="table table-striped">
    @foreach($rates as $rate)
        <tr>
            <td>{{ $rate->currencyCode }}</td>
            <td>{{ $rate->latestExchangeRate }}</td>
            <td>{{ $rate->updatedAt }}</td>
        </tr>
    @endforeach
</table>
@endsection

--------------------------------------------------------------------------------

–º–µ—Ç–æ–¥—ã create , update –¥–æ–ª–∂–Ω—ã –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å entity –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –µ—Å–ª–∏ –ø—Ä–∏ update –∏–ª–∏ delete –∑–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

--------------------------------------------------------------------------------

1. –ò—Å–∫–ª—é—á–µ–Ω–∏–µ ¬´Entity not found¬ª

–ó–∞–≤–µ–¥—ë–º –¥–æ–º–µ–Ω–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.

üìÑ app/Exceptions/EntityNotFoundException.php
<?php

namespace App\Exceptions;

use RuntimeException;

class EntityNotFoundException extends RuntimeException
{
}

‚úÖ 2. Repository ‚Äî create / update –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç Entity

–≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ update / delete

üìÑ app/Repositories/CurrencyRepository.php (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π)
<?php

namespace App\Repositories;

use App\DTO\CurrencyDTO;
use App\Entities\CurrencyEntity;
use App\Exceptions\EntityNotFoundException;
use App\Models\Currency;

/**
 * @return CurrencyEntity[]
 */
class CurrencyRepository
{
    /**
     * @return CurrencyEntity[]
     */
    public function all(): array
    {
        return Currency::query()
            ->latest()
            ->get()
            ->map(fn (Currency $currency) => $this->toEntity($currency))
            ->all();
    }

    public function create(CurrencyDTO $dto): CurrencyEntity
    {
        $currency = Currency::query()->create([
            'code' => $dto->code,
            'name_plural' => $dto->namePlural,
        ]);

        return $this->toEntity($currency);
    }

    public function update(int $id, CurrencyDTO $dto): CurrencyEntity
    {
        $currency = Currency::query()->find($id);

        if (!$currency) {
            throw new EntityNotFoundException("Currency {$id} not found");
        }

        $currency->update([
            'code' => $dto->code,
            'name_plural' => $dto->namePlural,
        ]);

        return $this->toEntity($currency);
    }

    public function delete(int $id): void
    {
        $currency = Currency::query()->find($id);

        if (!$currency) {
            throw new EntityNotFoundException("Currency {$id} not found");
        }

        $currency->delete(); // soft delete
    }

    private function toEntity(Currency $currency): CurrencyEntity
    {
        return new CurrencyEntity(
            id: $currency->id,
            code: $currency->code,
            namePlural: $currency->name_plural,
        );
    }
}

‚úÖ 3. Service ‚Äî –ø—Ä–æ–∫–∏–¥—ã–≤–∞–µ—Ç Entity –≤—ã—à–µ

Service –Ω–µ –ª–æ–≤–∏—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏.

üìÑ app/Services/CurrencyService.php (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π)
<?php

namespace App\Services;

use App\DTO\CurrencyDTO;
use App\Entities\CurrencyEntity;
use App\Repositories\CurrencyRepository;

/**
 * @return CurrencyEntity[]
 */
class CurrencyService
{
    public function __construct(
        private readonly CurrencyRepository $repository
    ) {}

    /**
     * @return CurrencyEntity[]
     */
    public function list(): array
    {
        return $this->repository->all();
    }

    public function create(CurrencyDTO $dto): CurrencyEntity
    {
        return $this->repository->create($dto);
    }

    public function update(int $id, CurrencyDTO $dto): CurrencyEntity
    {
        return $this->repository->update($id, $dto);
    }

    public function delete(int $id): void
    {
        $this->repository->delete($id);
    }
}

‚úÖ 4. Controller ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–π Entity

–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É –Ω–µ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–µ—Ä–Ω—É–ª–æ—Å—å ‚Äî –Ω–æ —Ç–µ–ø–µ—Ä—å –æ–Ω –º–æ–∂–µ—Ç, –µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è.

üìÑ CurrenciesController.php (—Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã)
public function store(CurrencyStoreRequest $request)
{
    $dto = new CurrencyDTO(
        code: $request->string('code'),
        namePlural: $request->string('name_plural'),
    );

    $currency = $this->service->create($dto);

    return redirect()
        ->route('currencies.index')
        ->with('success', "–í–∞–ª—é—Ç–∞ {$currency->code} —Å–æ–∑–¥–∞–Ω–∞");
}

public function update(CurrencyUpdateRequest $request, int $currency)
{
    $dto = new CurrencyDTO(
        code: $request->string('code'),
        namePlural: $request->string('name_plural'),
    );

    $updated = $this->service->update($currency, $dto);

    return redirect()
        ->route('currencies.index')
        ->with('success', "–í–∞–ª—é—Ç–∞ {$updated->code} –æ–±–Ω–æ–≤–ª–µ–Ω–∞");
}

public function destroy(int $currency)
{
    $this->service->delete($currency);

    return redirect()
        ->route('currencies.index')
        ->with('success', '–í–∞–ª—é—Ç–∞ —É–¥–∞–ª–µ–Ω–∞');
}

--------------------------------------------------------------------------------

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —à–∞–≥—É 4

--------------------------------------------------------------------------------

–≠–¢–ê–ü 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å FreeCurrencyAPI
üìå –ß—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ–º

–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –±–∞–∑–æ–≤—ã–π API-–∫–ª–∞—Å—Å –Ω–∞ Guzzle

–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å FreeCurrencyLatestRequest

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ .env

–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ cron / queue

4.1 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
üìÑ .env
CURRENCIES_API_KEY=your_api_key_here
CURRENCIES_API_URL=https://api.freecurrencyapi.com

4.2 –ë–∞–∑–æ–≤—ã–π –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π API-–∫–ª–∞—Å—Å
–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

–ò—Å–ø–æ–ª—å–∑—É–µ–º Guzzle

–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

endpoint

query params

–û–±—â–∏–π –º–µ—Ç–æ–¥ send()

üìÑ app/Http/Clients/BaseApiRequest.php
<?php

namespace App\Http\Clients;

use GuzzleHttp\Client;
use GuzzleHttp\Exception\GuzzleException;
use RuntimeException;

abstract class BaseApiRequest
{
    protected Client $client;

    public function __construct()
    {
        $this->client = new Client([
            'base_uri' => config('services.currency_api.url'),
            'timeout'  => 10,
        ]);
    }

    /**
     * URI —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä: /v1/latest
     */
    abstract protected function endpoint(): string;

    /**
     * Query-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
     */
    abstract protected function query(): array;

    /**
     * –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ HTTP-–∑–∞–ø—Ä–æ—Å–∞
     */
    public function send(): array
    {
        try {
            $response = $this->client->get($this->endpoint(), [
                'headers' => [
                    'apikey' => config('services.currency_api.key'),
                    'Accept' => 'application/json',
                ],
                'query' => $this->query(),
            ]);
        } catch (GuzzleException $e) {
            throw new RuntimeException(
                'Currency API request failed: ' . $e->getMessage(),
                previous: $e
            );
        }

        $data = json_decode(
            $response->getBody()->getContents(),
            true
        );

        if (!is_array($data)) {
            throw new RuntimeException('Invalid API response');
        }

        return $data;
    }
}

4.3 –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å FreeCurrencyAPI (latest)

–°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

GET /v1/latest

üìÑ app/Http/Clients/FreeCurrencyLatestRequest.php
<?php

namespace App\Http\Clients;

class FreeCurrencyLatestRequest extends BaseApiRequest
{
    protected function endpoint(): string
    {
        return '/v1/latest';
    }

    protected function query(): array
    {
        return [
            // –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å base_currency –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
        ];
    }
}

4.4 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è services.php
üìÑ config/services.php
return [

    // ...

    'currency_api' => [
        'url' => env('CURRENCIES_API_URL'),
        'key' => env('CURRENCIES_API_KEY'),
    ],

];

4.5 –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ API (–¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è)
{
  "data": {
    "USD": 1,
    "EUR": 0.92,
    "RUB": 90.21
  }
}


–ú—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ USD ‚Äî —ç—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è —à–∞–≥–∞ 6 (–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è).

4.6 –°–µ—Ä–≤–∏—Å-–æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ API (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ cron)

–ß—Ç–æ–±—ã job –Ω–µ –∑–Ω–∞–ª –æ HTTP, –¥–æ–±–∞–≤–ª—è–µ–º —Å–µ—Ä–≤–∏—Å.

üìÑ app/Services/CurrencyApiService.php
<?php

namespace App\Services;

use App\Http\Clients\FreeCurrencyLatestRequest;

class CurrencyApiService
{
    public function getLatestRates(): array
    {
        $response = (new FreeCurrencyLatestRequest())->send();

        return $response['data'] ?? [];
    }
}


üìå –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:

[
    'USD' => 1,
    'EUR' => 0.92,
    'RUB' => 90.21,
]

‚úÖ –ò—Ç–æ–≥ –≠–¢–ê–ü–ê 4

‚úî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –±–µ–∑ –≥–æ—Ç–æ–≤—ã—Ö SDK
‚úî –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω Guzzle
‚úî –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å
‚úî –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π API-–∫–ª–∏–µ–Ω—Ç
‚úî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ .env
‚úî –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ cron / queue
‚úî –ö–æ–¥ –ª–µ–≥–∫–æ –º–æ–∫–∞–µ—Ç—Å—è –≤ —Ç–µ—Å—Ç–∞—Ö

--------------------------------------------------------------------------------

–ø—Ä–∞–≤–∫–∏:
- –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–≥–æ BaseApiRequest –Ω–∞—Å–ª–µ–¥—É–µ–º –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π FreeCurrencyAPI –≤ –∫–æ—Ç–æ—Ä–æ–º —Ä–µ–∞–ª–∏–∑—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ API
- –≤ BaseApiRequest –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ new Client base_uri –±–µ—Ä–µ–º –∏–∑ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑—É–µ–º –≤ FreeCurrencyAPI 
- timeout –≤—ã–Ω–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É DEFAULT_TIMEOUT BaseApiRequest 
- —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ headers –≤—ã–Ω–µ—Å—Ç–∏ –≤ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –º–µ—Ç–æ–¥ –∏ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –≤ FreeCurrencyAPI 
- BaseApiRequest –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å –æ –¥–µ—Ç–∞–ª—è—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. —Ç.–µ. –Ω–µ —É–ø–æ–º–∏–Ω–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –ø—Ä–∏ –≤—ã–±—Ä–æ—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- –Ω–∞—Å–ª–µ–¥–Ω–∏–∫ FreeCurrencyLatestRequest –æ—Ç FreeCurrencyAPI , –º–µ—Ç–æ–¥ endpoint (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

–û—Ç–ª–∏—á–Ω—ã–µ –ø—Ä–∞–≤–∫–∏ ‚Äî –æ–Ω–∏ –∏–¥–µ–∞–ª—å–Ω–æ –≤—ã—á–∏—â–∞—é—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —Å–ª–æ—ë–≤ üëç
–ù–∏–∂–µ ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –∏ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã API-–∫–ª–∏–µ–Ω—Ç–∞, –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è —Ç–≤–æ–∏–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º.

–Ø –ø–æ–∫–∞–∂—É —Ç–æ–ª—å–∫–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∏–µ—Ä–∞—Ä—Ö–∏–∏.

‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è API-–∫–ª–∏–µ–Ω—Ç–æ–≤
BaseApiRequest (–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π, –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞–µ—Ç –æ–± API)
        ‚Üë
FreeCurrencyAPI (–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π, –∑–Ω–∞–µ—Ç –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π API)
        ‚Üë
FreeCurrencyLatestRequest (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π endpoint)

1Ô∏è‚É£ BaseApiRequest ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π
üìÑ app/Http/Clients/BaseApiRequest.php
<?php

namespace App\Http\Clients;

use GuzzleHttp\Client;
use GuzzleHttp\Exception\GuzzleException;
use RuntimeException;

abstract class BaseApiRequest
{
    protected const DEFAULT_TIMEOUT = 10;

    protected Client $client;

    public function __construct()
    {
        $this->client = new Client([
            'base_uri' => $this->baseUri(),
            'timeout'  => static::DEFAULT_TIMEOUT,
        ]);
    }

    /**
     * –ë–∞–∑–æ–≤—ã–π URL API
     */
    abstract protected function baseUri(): string;

    /**
     * HTTP headers
     */
    abstract protected function headers(): array;

    /**
     * Endpoint URI
     */
    abstract protected function endpoint(): string;

    /**
     * Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
     */
    abstract protected function query(): array;

    /**
     * –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
     */
    public function send(): array
    {
        try {
            $response = $this->client->get($this->endpoint(), [
                'headers' => $this->headers(),
                'query'   => $this->query(),
            ]);
        } catch (GuzzleException $e) {
            throw new RuntimeException(
                'HTTP request failed',
                previous: $e
            );
        }

        $data = json_decode(
            $response->getBody()->getContents(),
            true
        );

        if (!is_array($data)) {
            throw new RuntimeException('Invalid HTTP response');
        }

        return $data;
    }
}

‚úî –ß—Ç–æ –≤–∞–∂–Ω–æ

‚ùå –Ω–µ—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–π FreeCurrency

‚ùå –Ω–µ—Ç api key / headers

‚ùå –Ω–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö URL

‚úî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π HTTP-–∫–ª–∏–µ–Ω—Ç

2Ô∏è‚É£ FreeCurrencyAPI ‚Äî –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ API
üìÑ app/Http/Clients/FreeCurrencyAPI.php
<?php

namespace App\Http\Clients;

abstract class FreeCurrencyAPI extends BaseApiRequest
{
    protected function baseUri(): string
    {
        return config('services.currency_api.url');
    }

    protected function headers(): array
    {
        return [
            'apikey' => config('services.currency_api.key'),
            'Accept' => 'application/json',
        ];
    }

    protected function query(): array
    {
        return [];
    }
}

‚úî –ó–¥–µ—Å—å —Ç–µ–ø–µ—Ä—å:

URL API

API key

headers

–æ–±—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

3Ô∏è‚É£ FreeCurrencyLatestRequest ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π endpoint
üìÑ app/Http/Clients/FreeCurrencyLatestRequest.php
<?php

namespace App\Http\Clients;

class FreeCurrencyLatestRequest extends FreeCurrencyAPI
{
    protected function endpoint(): string
    {
        return '/v1/latest';
    }
}


üìå –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π, —á–∏—Å—Ç—ã–π, —á–∏—Ç–∞–µ–º—ã–π –∫–ª–∞—Å—Å ‚Äî –∫–∞–∫ –∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å endpoint.

4Ô∏è‚É£ CurrencyApiService ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (—É–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω)
üìÑ app/Services/CurrencyApiService.php
<?php

namespace App\Services;

use App\Http\Clients\FreeCurrencyLatestRequest;

class CurrencyApiService
{
    /**
     * @return array<string, float>
     */
    public function getLatestRates(): array
    {
        $response = (new FreeCurrencyLatestRequest())->send();

        return $response['data'] ?? [];
    }
}

--------------------------------------------------------------------------------

–Ω—É–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å CurrencyApiService –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –º–∞—Å—Å–∏–≤ DTO
—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å DTO —á–µ—Ä–µ–∑ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥ fromArray

–û—Ç–ª–∏—á–Ω–∞—è –ø—Ä–∞–≤–∫–∞ ‚Äî –ª–æ–≥–∏—á–µ—Å–∫–∏ –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è üëç
HTTP-—Å–ª–æ–π –Ω–µ –¥–æ–ª–∂–µ–Ω –æ—Ç–¥–∞–≤–∞—Ç—å ¬´—Å—ã—Ä—ã–µ –º–∞—Å—Å–∏–≤—ã¬ª, –∞ —Å—Ä–∞–∑—É —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å DTO.

–ù–∏–∂–µ ‚Äî –∞–∫–∫—É—Ä–∞—Ç–Ω–∞—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ —Å–ª–æ–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, —Å—Ç—Ä–æ–≥–æ –ø–æ —Ç–≤–æ–∏–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º.

‚úÖ 1. DTO –¥–ª—è –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç + fromArray

–ú—ã –±—É–¥–µ–º –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –º–∞—Å—Å–∏–≤ DTO, –≥–¥–µ –∫–∞–∂–¥—ã–π DTO ‚Äî –∫—É—Ä—Å –æ–¥–Ω–æ–π –≤–∞–ª—é—Ç—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ USD.

üìÑ app/DTO/CurrencyRateDTO.php (–¥–æ—Ä–∞–±–æ—Ç–∫–∞)
<?php

namespace App\DTO;

class CurrencyRateDTO
{
    public function __construct(
        public readonly string $currencyCode,
        public readonly float $latestExchangeRate,
    ) {}

    /**
     * @param array<string, float|int|string> $data
     * @return self[]
     */
    public static function fromArray(array $data): array
    {
        $result = [];

        foreach ($data as $code => $rate) {
            $result[] = new self(
                currencyCode: (string) $code,
                latestExchangeRate: (float) $rate,
            );
        }

        return $result;
    }
}


üìå –ü—Ä–∏–º–µ—Ä –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

[
    'USD' => 1,
    'EUR' => 0.92,
    'RUB' => 90.21,
]


üìå –†–µ–∑—É–ª—å—Ç–∞—Ç:

CurrencyRateDTO[]

‚úÖ 2. CurrencyApiService ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—Å–∏–≤ DTO

–¢–µ–ø–µ—Ä—å —Å–µ—Ä–≤–∏—Å:

–Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤

–Ω–µ –∑–Ω–∞–µ—Ç –æ —Ñ–æ—Ä–º–∞—Ç–µ API

–≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç CurrencyRateDTO[]

üìÑ app/Services/CurrencyApiService.php (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π)
<?php

namespace App\Services;

use App\DTO\CurrencyRateDTO;
use App\Http\Clients\FreeCurrencyLatestRequest;

class CurrencyApiService
{
    /**
     * @return CurrencyRateDTO[]
     */
    public function getLatestRates(): array
    {
        $response = (new FreeCurrencyLatestRequest())->send();

        if (!isset($response['data']) || !is_array($response['data'])) {
            return [];
        }

        return CurrencyRateDTO::fromArray($response['data']);
    }
}

‚úÖ 3. –ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ

‚úî HTTP-–∫–ª–∏–µ–Ω—Ç ‚Üí —Ç–æ–ª—å–∫–æ transport
‚úî Service ‚Üí —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç DTO
‚úî –î–∞–ª—å—à–µ:

Job ‚Üí Service ‚Üí DTO ‚Üí Repository ‚Üí Entity


‚úî DTO –ª–µ–≥–∫–æ:

–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å

–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å

—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

–º–æ–∫–∞—Ç—å

üéØ –ö–∞–∫ —ç—Ç–æ –æ–±—ä—è—Å–Ω–∏—Ç—å –Ω–∞ –∏–Ω—Ç–µ—Ä–≤—å—é

API-–∫–ª–∏–µ–Ω—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç DTO, —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ —Ñ–∞–±—Ä–∏—á–Ω—ã–π –º–µ—Ç–æ–¥.
–≠—Ç–æ –∏–∑–±–∞–≤–ª—è–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –æ—Ç —Ä–∞–±–æ—Ç—ã —Å –º–∞—Å—Å–∏–≤–∞–º–∏ –∏ –¥–µ–ª–∞–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å–µ—Ä–≤–∏—Å–∞ —Å—Ç—Ä–æ–≥–∏–º –∏ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º.

–≠—Ç–æ –æ—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–π architectural decision.

‚úÖ –ò—Ç–æ–≥

‚úî CurrencyApiService –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç CurrencyRateDTO[]
‚úî DTO —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ fromArray()
‚úî –ù–µ—Ç —É—Ç–µ—á–∫–∏ –¥–µ—Ç–∞–ª–µ–π API
‚úî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –µ—â—ë —á–∏—â–µ

üëâ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

–≠–¢–ê–ü 5 ‚Äî –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç (cron + queue + retry)

Job UpdateCurrencyRatesJob

Artisan command

Retry —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

–°–∫–∞–∂–∏: ¬´–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —à–∞–≥—É 5¬ª üöÄ

–ø—Ä–∞–≤–∫–∏ –ø–æ CurrencyRateDTO
–µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ –ø—Ä–∏—à–µ–ª (!isset($response['data']) || !is_array($response['data'])) - –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ –ª–æ–≥
DTO —Ñ–æ—Ä–º–∏—Ä—É–µ–º –Ω–µ –∏–∑ –≤—Å–µ–≥–æ –º–∞—Å—Å–∏–≤–∞ –∞ –ø—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø–æ data –∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ–º DTO
–µ—Å–ª–∏ –ø–æ–ª—É—á–∞–µ–º –æ—à–∏–±–∫—É –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ dto - –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ –ª–æ–≥

–û—Ç–ª–∏—á–Ω—ã–µ –ø—Ä–∞–≤–∫–∏ ‚Äî —ç—Ç–æ —É–∂–µ production-grade –ø–æ–¥—Ö–æ–¥ üëç
–î–∞–≤–∞–π –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –ø—Ä–∏–≤–µ–¥—ë–º –∫–æ–¥ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤—Å–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º, –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è —Å–ª–æ—ë–≤.

–ù–∏–∂–µ ‚Äî –∏—Ç–æ–≥–æ–≤–∞—è, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è.

‚úÖ 1. CurrencyRateDTO ‚Äî —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ DTO, —Å—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

DTO –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å –ø—Ä–æ –º–∞—Å—Å–∏–≤ –≤—Å–µ–≥–æ –æ—Ç–≤–µ—Ç–∞, —Ç–æ–ª—å–∫–æ –ø—Ä–æ –æ–¥–Ω—É –∑–∞–ø–∏—Å—å.

üìÑ app/DTO/CurrencyRateDTO.php
<?php

namespace App\DTO;

use InvalidArgumentException;

class CurrencyRateDTO
{
    public function __construct(
        public readonly string $currencyCode,
        public readonly float $latestExchangeRate,
    ) {}

    /**
     * @param string $currencyCode
     * @param mixed  $rate
     * @throws InvalidArgumentException
     */
    public static function fromItem(string $currencyCode, mixed $rate): self
    {
        if ($currencyCode === '') {
            throw new InvalidArgumentException('Currency code is empty');
        }

        if (!is_numeric($rate)) {
            throw new InvalidArgumentException(
                sprintf('Invalid exchange rate for currency %s', $currencyCode)
            );
        }

        return new self(
            currencyCode: $currencyCode,
            latestExchangeRate: (float) $rate,
        );
    }
}


üìå –í–∞–∂–Ω–æ:

DTO —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∏–∑ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏

–õ—é–±–∞—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚Üí –∏—Å–∫–ª—é—á–µ–Ω–∏–µ

DTO –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç ‚Äî —ç—Ç–æ –∑–∞–¥–∞—á–∞ —Å–µ—Ä–≤–∏—Å–∞

‚úÖ 2. CurrencyApiService ‚Äî —Å—Ç—Ä–æ–≥–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢–µ–ø–µ—Ä—å —Å–µ—Ä–≤–∏—Å:

–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ API

–ª–æ–≥–∏—Ä—É–µ—Ç –ª—é–±—É—é –æ—à–∏–±–∫—É

–≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤–≤–µ—Ä—Ö (–¥–ª—è Job retry)

üìÑ app/Services/CurrencyApiService.php
<?php

namespace App\Services;

use App\DTO\CurrencyRateDTO;
use App\Http\Clients\FreeCurrencyLatestRequest;
use Illuminate\Support\Facades\Log;
use RuntimeException;
use Throwable;

class CurrencyApiService
{
    /**
     * @return CurrencyRateDTO[]
     *
     * @throws RuntimeException
     */
    public function getLatestRates(): array
    {
        $response = (new FreeCurrencyLatestRequest())->send();

        if (!isset($response['data']) || !is_array($response['data'])) {
            Log::error('FreeCurrencyAPI: invalid response structure', [
                'response' => $response,
            ]);

            throw new RuntimeException('Invalid response from currency API');
        }

        $dtos = [];

        foreach ($response['data'] as $currencyCode => $rate) {
            try {
                $dtos[] = CurrencyRateDTO::fromItem(
                    (string) $currencyCode,
                    $rate
                );
            } catch (Throwable $e) {
                Log::error('Failed to create CurrencyRateDTO', [
                    'currency' => $currencyCode,
                    'rate'     => $rate,
                    'error'    => $e->getMessage(),
                ]);

                throw new RuntimeException(
                    'Failed to map currency rate DTO',
                    previous: $e
                );
            }
        }

        return $dtos;
    }
}

‚úÖ 3. –ü–æ—á–µ–º—É —ç—Ç–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

‚úî DTO ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç
‚úî –°–µ—Ä–≤–∏—Å:

–∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç DTO

–ª–æ–≥–∏—Ä—É–µ—Ç

–≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è

‚úî Job / Command —Å–º–æ–∂–µ—Ç:

–ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–¥–∞—á—É

–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–ø–∞—Å—Ç—å

–æ—Å—Ç–∞–≤–∏—Ç—å –ª–æ–≥

API Client
   ‚Üì
Service (–≤–∞–ª–∏–¥–∞—Ü–∏—è + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
   ‚Üì
DTO[]
   ‚Üì
Repository ‚Üí Entity

--------------------------------------------------------------------------------

–ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —à–∞–≥—É 5

–≠–¢–ê–ü 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤ (cron + queue)
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

Job: UpdateCurrencyRatesJob

Command: currency:update-rates

–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (Kernel)

–õ–æ–≥–∏–∫–∞:

–ó–∞–ø—Ä–æ—Å –∫ API

–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞:

–ª–æ–≥

retry —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç

–ø—Ä–∏–º–µ—Ä App\Console\Kernel
    /**
     * Define the application's command schedule.
     */
    protected function schedule(Schedule $schedule): void
    {
        $schedule->job(new UpdateCurrencyRatesJob())->dailyAt('0:00')->onOneServer()->withoutOverlapping();
    }

–∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª–∞—Å—Å CurrencyRateUpdaterService
–≤ –Ω–µ–º –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ Currencies –∏ CurrenciesRates

—Ä–µ–∞–ª–∏–∑—É–µ–º –º–µ—Ç–æ–¥ update, –≤ –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–¥–∞–µ–º –º–∞—Å—Å–∏–≤ CurrencyRateDTO
–ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ñ–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ Currencies code - currencies id
–Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ id —Ñ–æ—Ä–º–∏—Ä—É–µ–º dto –∏ –ø–µ—Ä–µ–¥–∞–µ–º –≤ CurrenciesRatesRepository

--------------------------------------------------------------------------------

CurrencyRateUpdaterService

–°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç:

–ü—Ä–∏–Ω–∏–º–∞—Ç—å –º–∞—Å—Å–∏–≤ CurrencyRateDTO

–°–æ—Å—Ç–∞–≤–ª—è—Ç—å map code ‚Üí id –¥–ª—è –≤–∞–ª—é—Ç

–§–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å DTO –¥–ª—è CurrencyRateRepository

–í—ã–∑—ã–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

üìÑ app/Services/CurrencyRateUpdaterService.php
<?php

namespace App\Services;

use App\DTO\CurrencyRateDTO;
use App\DTO\CurrencyRateStoreDTO;
use App\Repositories\CurrencyRepository;
use App\Repositories\CurrencyRateRepository;
use Illuminate\Support\Facades\Log;
use RuntimeException;

class CurrencyRateUpdaterService
{
    public function __construct(
        private readonly CurrencyRepository $currencyRepository,
        private readonly CurrencyRateRepository $currencyRateRepository
    ) {}

    /**
     * @param CurrencyRateDTO[] $rates
     * @throws RuntimeException
     */
    public function update(array $rates): void
    {
        try {
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –≤–∞–ª—é—Ç—ã
            $currencies = $this->currencyRepository->all();

            // –§–æ—Ä–º–∏—Ä—É–µ–º map: code => id
            $codeToId = [];
            foreach ($currencies as $currency) {
                $codeToId[$currency->code] = $currency->id;
            }

            foreach ($rates as $rateDto) {
                /** @var CurrencyRateDTO $rateDto */
                if (!isset($codeToId[$rateDto->currencyCode])) {
                    Log::warning(
                        'Currency not found for rate update',
                        ['currency' => $rateDto->currencyCode]
                    );
                    continue;
                }

                // –§–æ—Ä–º–∏—Ä—É–µ–º DTO –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
                $rateStoreDto = new CurrencyRateStoreDTO(
                    currencyId: $codeToId[$rateDto->currencyCode],
                    latestExchangeRate: $rateDto->latestExchangeRate
                );

                $this->currencyRateRepository->updateOrCreate($rateStoreDto);
            }

            Log::info('Currency rates updated successfully');
        } catch (\Throwable $e) {
            Log::error('Failed to update currency rates', ['error' => $e->getMessage()]);
            throw new RuntimeException('Currency update failed', previous: $e);
        }
    }
}

2Ô∏è‚É£ DTO –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫—É—Ä—Å–∞
üìÑ app/DTO/CurrencyRateStoreDTO.php
<?php

namespace App\DTO;

class CurrencyRateStoreDTO
{
    public function __construct(
        public readonly int $currencyId,
        public readonly float $latestExchangeRate
    ) {}
}

3Ô∏è‚É£ CurrencyRateRepository ‚Äî –º–µ—Ç–æ–¥ updateOrCreate
/**
 * @param CurrencyRateStoreDTO $dto
 */
public function updateOrCreate(CurrencyRateStoreDTO $dto): void
{
    \App\Models\CurrencyRate::query()->updateOrCreate(
        ['currency_id' => $dto->currencyId],
        ['latest_exchange_rate' => $dto->latestExchangeRate]
    );
}

4Ô∏è‚É£ Job ‚Äî UpdateCurrencyRatesJob

Job —Ç–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç DTO –∏–∑ API –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç —Å–µ—Ä–≤–∏—Å—É:

<?php

namespace App\Jobs;

use App\Services\CurrencyApiService;
use App\Services\CurrencyRateUpdaterService;
use Illuminate\Bus\Queueable;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Foundation\Bus\Dispatchable;
use Illuminate\Queue\InteractsWithQueue;
use Illuminate\Queue\SerializesModels;
use Illuminate\Support\Facades\Log;
use RuntimeException;

class UpdateCurrencyRatesJob implements ShouldQueue
{
    use Dispatchable, InteractsWithQueue, Queueable, SerializesModels;

    public int $tries = 3;
    public int $backoff = 600; // 10 –º–∏–Ω—É—Ç

    public function __construct(
        private readonly CurrencyApiService $apiService,
        private readonly CurrencyRateUpdaterService $updaterService
    ) {}

    public function handle(): void
    {
        try {
            $rates = $this->apiService->getLatestRates();

            $this->updaterService->update($rates);
        } catch (RuntimeException $e) {
            Log::error('UpdateCurrencyRatesJob failed', ['error' => $e->getMessage()]);
            throw $e; // retry
        }
    }
}

5Ô∏è‚É£ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ ‚Äî Kernel
protected function schedule(Schedule $schedule): void
{
    $schedule->job(new UpdateCurrencyRatesJob(
        app(\App\Services\CurrencyApiService::class),
        app(\App\Services\CurrencyRateUpdaterService::class)
    ))
    ->dailyAt('0:00')
    ->onOneServer()
    ->withoutOverlapping();
}

--------------------------------------------------------------------------------

–ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —ç—Ç–∞–ø—É 6. –ø–æ –ø–ª–∞–Ω—É –°–µ—Ä–≤–∏—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∞–ª—é—Ç –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å interface CurrencyConverterInterface { public function convert(float $amount, string $from, string $to): float; } –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ latest_exchange_rate –±–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ ‚Äî USD üìå –§–æ—Ä–º—É–ª–∞: amount_in_usd = amount / from_rate result = amount_in_usd * to_rate

--------------------------------------------------------------------------------

–û—Ç–ª–∏—á–Ω–æ, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —ç—Ç–∞–ø—É 6 ‚Äî —Å–µ—Ä–≤–∏—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∞–ª—é—Ç. –°–¥–µ–ª–∞–µ–º –µ–≥–æ —Å—Ç—Ä–æ–≥–æ –ø–æ –¢–ó: –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å + —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ latest_exchange_rate, –±–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ ‚Äî USD.

1Ô∏è‚É£ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å CurrencyConverterInterface
üìÑ app/Services/Currency/Interfaces/CurrencyConverterInterface.php
<?php

namespace App\Services\Currency\Interfaces;

interface CurrencyConverterInterface
{
    /**
     * –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Å—É–º–º—ã –∏–∑ –æ–¥–Ω–æ–π –≤–∞–ª—é—Ç—ã –≤ –¥—Ä—É–≥—É—é
     *
     * @param float  $amount
     * @param string $from  –ö–æ–¥ –∏—Å—Ö–æ–¥–Ω–æ–π –≤–∞–ª—é—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'EUR')
     * @param string $to    –ö–æ–¥ —Ü–µ–ª–µ–≤–æ–π –≤–∞–ª—é—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'RUB')
     * @return float
     */
    public function convert(float $amount, string $from, string $to): float;
}

2Ô∏è‚É£ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è CurrencyConverter

–õ–æ–≥–∏–∫–∞:

–ü–æ–ª—É—á–∞–µ–º –∫—É—Ä—Å—ã from –∏ to —á–µ—Ä–µ–∑ CurrencyRateRepository

–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ –±–∞–∑–æ–≤—É—é –≤–∞–ª—é—Ç—É USD:

amount_in_usd = amount / from_rate
result = amount_in_usd * to_rate

üìÑ app/Services/Currency/CurrencyConverter.php
<?php

namespace App\Services\Currency;

use App\Repositories\CurrencyRateRepository;
use App\Services\Currency\Interfaces\CurrencyConverterInterface;
use RuntimeException;

class CurrencyConverter implements CurrencyConverterInterface
{
    public function __construct(
        private readonly CurrencyRateRepository $currencyRateRepository
    ) {}

    public function convert(float $amount, string $from, string $to): float
    {
        $fromRate = $this->currencyRateRepository->getLatestRateByCode($from);
        $toRate   = $this->currencyRateRepository->getLatestRateByCode($to);

        if ($fromRate === null) {
            throw new RuntimeException("Currency rate not found for '{$from}'");
        }

        if ($toRate === null) {
            throw new RuntimeException("Currency rate not found for '{$to}'");
        }

        // –§–æ—Ä–º—É–ª–∞ —á–µ—Ä–µ–∑ USD
        $amountInUsd = $amount / $fromRate;
        $result = $amountInUsd * $toRate;

        return round($result, 4); // –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 4 –∑–Ω–∞–∫–æ–≤
    }
}

3Ô∏è‚É£ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Äî –º–µ—Ç–æ–¥ getLatestRateByCode

–î–æ–±–∞–≤–∏–º –º–µ—Ç–æ–¥ –≤ CurrencyRateRepository:

/**
 * –ü–æ–ª—É—á–∏—Ç—å –∫—É—Ä—Å –≤–∞–ª—é—Ç—ã –∫ USD –ø–æ –∫–æ–¥—É –≤–∞–ª—é—Ç—ã
 *
 * @param string $code
 * @return float|null
 */
public function getLatestRateByCode(string $code): ?float
{
    $currency = \App\Models\Currency::query()
        ->where('code', $code)
        ->first();

    if (!$currency) {
        return null;
    }

    $rate = \App\Models\CurrencyRate::query()
        ->where('currency_id', $currency->id)
        ->latest()
        ->first();

    return $rate?->latest_exchange_rate;
}

4Ô∏è‚É£ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
$converter = app(\App\Services\Currency\CurrencyConverter::class);

$amountInRub = $converter->convert(100, 'USD', 'RUB');
$amountInEur = $converter->convert(100, 'USD', 'EUR');


--------------------------------------------------------------------------------

–ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ 7 —ç—Ç–∞–ø—É –ø–ª–∞–Ω: –≠–¢–ê–ü 7. –ü—É–±–ª–∏—á–Ω—ã–π API (v1) Endpoint POST /api/v1/convert Controller CurrencyConvertController Request validation Response { "amount": 100, "from": "USD", "to": "EUR", "result": 92.34 —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ä–µ–∫–≤–µ—Å—Ç –≤ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –≤–∞–ª—é—Ç –ø–æ –∫–æ–¥—É –≤ –ë–î –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å dto dto –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ —Å–µ—Ä–≤–∏—Å –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å dto —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∑–∞–ø—Ä–æ—Å–∞ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º

--------------------------------------------------------------------------------

DTO –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ—Ç–≤–µ—Ç–∞
üìÑ app/DTO/CurrencyConvertRequestDTO.php
<?php

namespace App\DTO;

class CurrencyConvertRequestDTO
{
    public function __construct(
        public readonly float $amount,
        public readonly string $from,
        public readonly string $to
    ) {}
}

üìÑ app/DTO/CurrencyConvertResponseDTO.php
<?php

namespace App\DTO;

class CurrencyConvertResponseDTO
{
    public function __construct(
        public readonly float $amount,
        public readonly string $from,
        public readonly string $to,
        public readonly float $result
    ) {}
}

2Ô∏è‚É£ –ö–∞—Å—Ç–æ–º–Ω—ã–π Request

–†–µ–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –≤–∞–ª—é—Ç –≤ –±–∞–∑–µ.

üìÑ app/Http/Requests/CurrencyConvertRequest.php
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;
use App\Models\Currency;

class CurrencyConvertRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }

    public function rules(): array
    {
        return [
            'amount' => ['required','numeric','min:0'],
            'from'   => ['required','string','exists:currencies,code'],
            'to'     => ['required','string','exists:currencies,code'],
        ];
    }

    public function messages(): array
    {
        return [
            'from.exists' => '–ò—Å—Ö–æ–¥–Ω–∞—è –≤–∞–ª—é—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞',
            'to.exists'   => '–¶–µ–ª–µ–≤–∞—è –≤–∞–ª—é—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞',
        ];
    }

    public function toDTO(): \App\DTO\CurrencyConvertRequestDTO
    {
        return new \App\DTO\CurrencyConvertRequestDTO(
            amount: (float) $this->input('amount'),
            from: $this->input('from'),
            to: $this->input('to')
        );
    }
}

3Ô∏è‚É£ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä CurrencyConvertController
üìÑ app/Http/Controllers/Api/V1/CurrencyConvertController.php
<?php

namespace App\Http\Controllers\Api\V1;

use App\Http\Controllers\Controller;
use App\Http\Requests\CurrencyConvertRequest;
use App\Services\Currency\CurrencyConverter;
use App\DTO\CurrencyConvertResponseDTO;

class CurrencyConvertController extends Controller
{
    public function __construct(
        private readonly CurrencyConverter $converter
    ) {}

    public function __invoke(CurrencyConvertRequest $request)
    {
        $dto = $request->toDTO();

        $result = $this->converter->convert(
            $dto->amount,
            $dto->from,
            $dto->to
        );

        $responseDto = new CurrencyConvertResponseDTO(
            amount: $dto->amount,
            from: $dto->from,
            to: $dto->to,
            result: $result
        );

        return response()->json([
            'amount' => $responseDto->amount,
            'from'   => $responseDto->from,
            'to'     => $responseDto->to,
            'result' => $responseDto->result,
        ]);
    }
}

4Ô∏è‚É£ API Route
üìÑ routes/api.php
use App\Http\Controllers\Api\V1\CurrencyConvertController;

Route::prefix('v1')->group(function () {
    Route::post('/convert', CurrencyConvertController::class);
});

--------------------------------------------------------------------------------

–ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –≠–¢–ê–ü 8. –°–∏–¥—ã CurrencySeeder –∑–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –≤–∞–ª—é—Ç –∏—Å—Ç–æ—á–Ω–∏–∫: docs freecurrencyapi UserSeeder login: admin password: admin (bcrypt) role: admin —Å–ø–∏—Å–æ–∫ –≤–∞–ª—é—Ç –≤ –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω—ã–π –º–∞—Å—Å–∏–≤ –≤–∏–¥–∞ –∫–æ–¥ => –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞–ª—é—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –ë–î Currency List Code Name EUR Euro USD US Dollar JPY Japanese Yen BGN Bulgarian Lev CZK Czech Republic Koruna DKK Danish Krone GBP British Pound Sterling HUF Hungarian Forint PLN Polish Zloty RON Romanian Leu SEK Swedish Krona CHF Swiss Franc ISK Icelandic Kr√≥na NOK Norwegian Krone HRK Croatian Kuna RUB Russian Ruble TRY Turkish Lira AUD Australian Dollar BRL Brazilian Real CAD Canadian Dollar CNY Chinese Yuan HKD Hong Kong Dollar IDR Indonesian Rupiah ILS Israeli New Sheqel INR Indian Rupee KRW South Korean Won MXN Mexican Peso MYR Malaysian Ringgit NZD New Zealand Dollar PHP Philippine Peso SGD Singapore Dollar THB Thai Baht ZAR South African Rand


--------------------------------------------------------------------------------


CurrencySeeder

–°–∏–¥ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤–∞–ª—é—Ç –≤ —Ç–∞–±–ª–∏—Ü—É currencies.

üìÑ database/seeders/CurrencySeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Currency;

class CurrencySeeder extends Seeder
{
    public function run(): void
    {
        $currencies = [
    'EUR' => 'Euro',
    'USD' => 'US Dollar',
    'JPY' => 'Japanese Yen',
    'BGN' => 'Bulgarian Lev',
    'CZK' => 'Czech Republic Koruna',
    'DKK' => 'Danish Krone',
    'GBP' => 'British Pound Sterling',
    'HUF' => 'Hungarian Forint',
    'PLN' => 'Polish Zloty',
    'RON' => 'Romanian Leu',
    'SEK' => 'Swedish Krona',
    'CHF' => 'Swiss Franc',
    'ISK' => 'Icelandic Kr√≥na',
    'NOK' => 'Norwegian Krone',
    'HRK' => 'Croatian Kuna',
    'RUB' => 'Russian Ruble',
    'TRY' => 'Turkish Lira',
    'AUD' => 'Australian Dollar',
    'BRL' => 'Brazilian Real',
    'CAD' => 'Canadian Dollar',
    'CNY' => 'Chinese Yuan',
    'HKD' => 'Hong Kong Dollar',
    'IDR' => 'Indonesian Rupiah',
    'ILS' => 'Israeli New Sheqel',
    'INR' => 'Indian Rupee',
    'KRW' => 'South Korean Won',
    'MXN' => 'Mexican Peso',
    'MYR' => 'Malaysian Ringgit',
    'NZD' => 'New Zealand Dollar',
    'PHP' => 'Philippine Peso',
    'SGD' => 'Singapore Dollar',
    'THB' => 'Thai Baht',
    'ZAR' => 'South African Rand',
];

foreach ($currencies as $code => $name) {
    Currency::updateOrCreate(
        ['code' => $code],
        ['name_plural' => $name]
    );
}
    }
}

2Ô∏è‚É£ UserSeeder

–°–æ–∑–¥–∞–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:

login: admin

password: admin (bcrypt)

role: admin

üìÑ database/seeders/UserSeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\User;
use Illuminate\Support\Facades\Hash;

class UserSeeder extends Seeder
{
    public function run(): void
    {
        User::updateOrCreate(
            ['login' => 'admin'],
            [
                'password' => Hash::make('admin'),
                'role' => 'admin',
            ]
        );
    }
}

3Ô∏è‚É£ DatabaseSeeder

–ù–µ –∑–∞–±—É–¥–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç—å –æ–±–∞ —Å–∏–¥–µ—Ä–∞:

üìÑ database/seeders/DatabaseSeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
    public function run(): void
    {
        $this->call([
            CurrencySeeder::class,
            UserSeeder::class,
        ]);
    }
}


--------------------------------------------------------------------------------

